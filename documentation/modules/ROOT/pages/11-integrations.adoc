= Integrations
include::_attributes.adoc[]
:profile: acs

NOTE: In RHACS the Scanner component only scans those images that are not already scanned by other integrated vulnerability scanners. It means that if you have integrated Red Hat Advanced Cluster Security for Kubernetes with other vulnerability scanners, Scanner checks and uses the scanning results from the integrated scanner if available.

[#integrate_with_internal_openshift_registry]
== Integrate with Internal Openshift Registry

Idea originally posted by Mark Roberts in https://cloud.redhat.com/blog/using-red-hat-advanced-cluster-security-with-the-openshift-registry[this great blog post], and adapt to consume internally 

Red Hat Advanced Cluster Security can be used to scan images held within OpenShift image streams (the OpenShift registry). 

This can be helpful within continuous integration processes, to enable organizations to scan images for policy violations and vulnerabilities prior to pushing the image to an external container registry. 

In this way, the quality of container images that get to the external registry improves, and triggered activities that result from a new image appearing in the registry only happen for a good reason.

Generate a namespace and extract the token name of the 

[.console-input]
[source,bash,subs="attributes+,+macros"]	
----	
export NSINTEGRATION="integration-internal-registry"

oc new-project $NSINTEGRATION

SECRET_TOKEN_NAME=$(oc get sa -n $NSINTEGRATION default -o jsonpath='{.secrets[*]}' | jq -r .name | grep token)

PIPELINE_TOKEN=$(oc get secret -n $NSINTEGRATION $SECRET_TOKEN_NAME -o jsonpath='{.data.token}' | base64 -d)
echo $PIPELINE_TOKEN

oc policy add-role-to-user admin system:serviceaccount:$NSINTEGRATION:pipeline -n $NSINTEGRATION
----

[#integrate_with_internal_openshift_registry_config_acs]
== Integrate with Internal Openshift Registry

To allow the roxctl command line interface to scan the images within the OpenShift registry, add an integration of type “Generic Docker Registry'', from the Platform Configuration - Integrations menu.

Fill in the fields as shown in figure 1, giving the integration a unique name that should include the cluster name for practicality. Paste in the username and token and select Disable TLS certificate validation if you need insecure https communication to a test cluster, for example.

Press the test button to validate the connection and press “save” when the test is successful.

image::integrations/03-registry_ocp_internal.png[ACS Integrations 1, 800]

TODO: Finish the integration!!



